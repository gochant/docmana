!function(t,e){"function"==typeof define&&define.amd?define(["jquery","lodash","backbone","bootstrap"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("lodash"),require("backbone"),require("bootstrap")):t.docmana=e(t.jQuery,t._,t.Backbone,t.undefined)}(this,function(t,e,n,i){var a=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,o=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(s,r,c){var d=a;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(r=s,s=i),s=s?new Date(s):new Date,isNaN(s))throw SyntaxError("invalid date");r=String(d.masks[r]||r||d.masks["default"]),"UTC:"==r.slice(0,4)&&(r=r.slice(4),c=!0);var l=c?"getUTC":"get",u=s[l+"Date"](),m=s[l+"Day"](),p=s[l+"Month"](),h=s[l+"FullYear"](),f=s[l+"Hours"](),v=s[l+"Minutes"](),g=s[l+"Seconds"](),b=s[l+"Milliseconds"](),y=c?0:s.getTimezoneOffset(),w={d:u,dd:o(u),ddd:d.i18n.dayNames[m],dddd:d.i18n.dayNames[m+7],m:p+1,mm:o(p+1),mmm:d.i18n.monthNames[p],mmmm:d.i18n.monthNames[p+12],yy:String(h).slice(2),yyyy:h,h:f%12||12,hh:o(f%12||12),H:f,HH:o(f),M:v,MM:o(v),s:g,ss:o(g),l:o(b,3),L:o(b>99?Math.round(b/10):b),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:c?"UTC":(String(s).match(e)||[""]).pop().replace(n,""),o:(y>0?"-":"+")+o(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][u%10>3?0:(u%100-u%10!=10)*u%10]};return r.replace(t,function(t){return t in w?w[t]:t.slice(1,t.length-1)})}}();a.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},a.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(t,e){return a(this,t,e)};var o;!function(e){var n=function(){function t(t){"undefined"==typeof t&&(t=30),this.space=t}return t}();e.AutosizeInputOptions=n;var a=function(){function e(n,i){var a=this;this._input=t(n),this._options=t.extend({},e.getDefaultOptions(),i),this._mirror=t('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),t.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(t,e){a._mirror[0].style[e]=a._input.css(e)}),t("body").append(this._mirror),this._input.on("keydown keyup input propertychange change",function(t){a.update()}),function(){a.update()}()}return e.prototype.getOptions=function(){return this._options},e.prototype.update=function(){var t=this._input.val()||"";if(t!==this._mirror.text()){this._mirror.text(t);var e=this._mirror.width()+this._options.space;this._input.width(e)}},e.getDefaultOptions=function(){return this._defaultOptions},e.getInstanceKey=function(){return"autosizeInputInstance"},e._defaultOptions=new n,e}();e.AutosizeInput=a,function(t){var n="autosize-input",a=["text","password","search","url","tel","email","number"];t.fn.autosizeInput=function(o){return this.each(function(){if("INPUT"==this.tagName&&t.inArray(this.type,a)>-1){var s=t(this);s.data(e.AutosizeInput.getInstanceKey())||(o==i&&(o=s.data(n)),s.data(e.AutosizeInput.getInstanceKey(),new e.AutosizeInput(this,o)))}})},t(function(){t("input[data-"+n+"]").autosizeInput()})}(jQuery)}(o||(o={})),function(t,e){var n=/[<>&\r\n"']/gm,i={"<":"lt;",">":"gt;","&":"amp;","\r":"#13;","\n":"#10;",'"':"quot;","'":"#39;"};t.extend({fileDownload:function(a,o){function s(){var e=p.cookieValue;"string"==typeof e&&(e=e.toLowerCase());var n=p.cookieName.toLowerCase()+"="+e;if(document.cookie.toLowerCase().indexOf(n)>-1){b.onSuccess(a);var i=p.cookieName+"=; path="+p.cookiePath+"; expires="+new Date(0).toUTCString()+";";return p.cookieDomain&&(i+=" domain="+p.cookieDomain+";"),document.cookie=i,void c(!1)}if(w||y)try{var o=w?w.document:r(y);if(o&&null!==o.body&&o.body.innerHTML.length){var d=!0;if(k&&k.length){var l=t(o.body).contents().first();try{l.length&&l[0]===k[0]&&(d=!1)}catch(u){if(!u||-2146828218!=u.number)throw u;d=!0}}if(d)return void setTimeout(function(){b.onFail(o.body.innerHTML,a),c(!0)},100)}}catch(m){return b.onFail("",a,m),void c(!0)}setTimeout(s,p.checkInterval)}function r(t){var e=t[0].contentWindow||t[0].contentDocument;return e.document&&(e=e.document),e}function c(t){setTimeout(function(){w&&(u&&w.close(),l&&w.focus&&(w.focus(),t&&w.close()))},0)}function d(t){return t.replace(n,function(t){return"&"+i[t]})}var l,u,m,p=t.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},prepareCallback:function(t){},successCallback:function(t){},failCallback:function(t,e,n){},httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",cookieDomain:null,popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},o),h=new t.Deferred,f=(navigator.userAgent||navigator.vendor||e.opera).toLowerCase();/ip(ad|hone|od)/.test(f)?l=!0:-1!==f.indexOf("android")?u=!0:m=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(f)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(f.substr(0,4));var v=p.httpMethod.toUpperCase();if(u&&"GET"!==v&&p.androidPostUnsupportedMessageHtml)return t().dialog?t("<div>").html(p.androidPostUnsupportedMessageHtml).dialog(p.dialogOptions):alert(p.androidPostUnsupportedMessageHtml),h.reject();var g=null,b={onPrepare:function(e){p.preparingMessageHtml?g=t("<div>").html(p.preparingMessageHtml).dialog(p.dialogOptions):p.prepareCallback&&p.prepareCallback(e)},onSuccess:function(t){g&&g.dialog("close"),p.successCallback(t),h.resolve(t)},onFail:function(e,n,i){g&&g.dialog("close"),p.failMessageHtml&&t("<div>").html(p.failMessageHtml).dialog(p.dialogOptions),p.failCallback(e,n,i),h.reject(e,n)}};b.onPrepare(a),null!==p.data&&"string"!=typeof p.data&&(p.data=t.param(p.data));var y,w,x,k;if("GET"===v){if(null!==p.data){var T=a.indexOf("?");-1!==T?"&"!==a.substring(a.length-1)&&(a+="&"):a+="?",a+=p.data}l||u?(w=e.open(a),w.document.title=p.popupWindowTitle,e.focus()):m?e.location(a):y=t("<iframe>").hide().prop("src",a).appendTo("body")}else{var _="";null!==p.data&&t.each(p.data.replace(/\+/g," ").split("&"),function(){var t=this.split("="),e=t[0];t.shift();var n=t.join("=");t=[e,n];var i=p.encodeHTMLEntities?d(decodeURIComponent(t[0])):decodeURIComponent(t[0]);if(i){var a=p.encodeHTMLEntities?d(decodeURIComponent(t[1])):decodeURIComponent(t[1]);_+='<input type="hidden" name="'+i+'" value="'+a+'" />'}}),m?(k=t("<form>").appendTo("body"),k.hide().prop("method",p.httpMethod).prop("action",a).html(_)):(l?(w=e.open("about:blank"),w.document.title=p.popupWindowTitle,x=w.document,e.focus()):(y=t("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),x=r(y)),x.write("<html><head></head><body><form method='"+p.httpMethod+"' action='"+a+"'>"+_+"</form>"+p.popupWindowTitle+"</body></html>"),k=t(x).find("form")),k.submit()}setTimeout(s,p.checkInterval);var C=h.promise();return C.abort=function(){c(),y.remove()},C}})}(jQuery,this),function(t){function e(e){if("string"==typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"==typeof e.data.keys){var n=e.handler,i=e.data.keys.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!(t.hotkeys.options.filterInputAcceptingElements&&t.hotkeys.textInputTypes.test(e.target.nodeName)||t.hotkeys.options.filterContentEditable&&t(e.target).attr("contenteditable")||t.hotkeys.options.filterTextInputs&&t.inArray(e.target.type,t.hotkeys.textAcceptingInputTypes)>-1)){var a="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],o=String.fromCharCode(e.which).toLowerCase(),s="",r={};t.each(["alt","ctrl","shift"],function(t,n){e[n+"Key"]&&a!==n&&(s+=n+"+")}),e.metaKey&&!e.ctrlKey&&"meta"!==a&&(s+="meta+"),e.metaKey&&"meta"!==a&&s.indexOf("alt+ctrl+shift+")>-1&&(s=s.replace("alt+ctrl+shift+","hyper+")),a?r[s+a]=!0:(r[s+o]=!0,r[s+t.hotkeys.shiftNums[o]]=!0,"shift+"===s&&(r[t.hotkeys.shiftNums[o]]=!0));for(var c=0,d=i.length;d>c;c++)if(r[i[c]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.2.0",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},textAcceptingInputTypes:["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"],textInputTypes:/textarea|input|select/i,options:{filterInputAcceptingElements:!0,filterTextInputs:!0,filterContentEditable:!0}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})}(jQuery||this.jQuery||window.jQuery),function(){"use strict";if("undefined"==typeof window||"undefined"==typeof navigator)return!1;var t,e,n,i,a,o,s,r,c,d,l,u="2.0.201604172",m="undefined"!=typeof navigator.mimeTypes["application/pdf"],p=function(){return/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase())}();e=function(t){var e;try{e=new ActiveXObject(t)}catch(n){e=null}return e},n=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},i=function(){return!(!e("AcroPDF.PDF")&&!e("PDF.PdfCtrl"))},t=m||n()&&i(),a=function(t){var e,n="";if(t){for(e in t)t.hasOwnProperty(e)&&(n+=encodeURIComponent(e)+"="+encodeURIComponent(t[e])+"&");n&&(n="#"+n,n=n.slice(0,n.length-1))}return n},o=function(t){"undefined"!=typeof console&&console.log&&console.log("[PDFObject] "+t)},s=function(t){return o(t),!1},c=function(t){var e=document.body;return"string"==typeof t?e=document.querySelector(t):"undefined"!=typeof jQuery&&t instanceof jQuery&&t.length?e=t.get(0):"undefined"!=typeof t.nodeType&&1===t.nodeType&&(e=t),e},d=function(t,e,n,i,a){var o=i+"?file="+encodeURIComponent(e)+n,s=p?"-webkit-overflow-scrolling: touch; overflow-y: scroll; ":"overflow: hidden; ",r="<div style='"+s+"position: absolute; top: 0; right: 0; bottom: 0; left: 0;'><iframe  "+a+" src='"+o+"' style='border: none; width: 100%; height: 100%;' frameborder='0'></iframe></div>";return t.className+=" pdfobject-container",t.style.position="relative",t.style.overflow="auto",t.innerHTML=r,t.getElementsByTagName("iframe")[0]},l=function(t,e,n,i,a,o,s){var r="";return r=e&&e!==document.body?"width: "+a+"; height: "+o+";":"position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;",t.className+=" pdfobject-container",t.innerHTML="<embed "+s+" class='pdfobject' src='"+n+i+"' type='application/pdf' style='overflow: auto; "+r+"'/>",t.getElementsByTagName("embed")[0]},r=function(e,n,i){if("string"!=typeof e)return s("URL is not valid");n="undefined"!=typeof n?n:!1,i="undefined"!=typeof i?i:{};var o=i.id&&"string"==typeof i.id?"id='"+i.id+"'":"",r=i.page?i.page:!1,u=i.pdfOpenParams?i.pdfOpenParams:{},m="undefined"!=typeof i.fallbackLink?i.fallbackLink:!0,p=i.width?i.width:"100%",h=i.height?i.height:"100%",f="boolean"==typeof i.forcePDFJS?i.forcePDFJS:!1,v=i.PDFJS_URL?i.PDFJS_URL:!1,g=c(n),b="",y="",w="<p>This browser does not support inline PDFs. Please download the PDF to view it: <a href='[url]'>Download PDF</a></p>";return g?(r&&(u.page=r),y=a(u),f&&v?d(g,e,y,v,o):t?l(g,n,e,y,p,h,o):v?d(g,e,y,v,o):(m&&(b="string"==typeof m?m:w,g.innerHTML=b.replace(/\[url\]/g,e)),s("This browser does not support embedded PDFs"))):s("Target element cannot be determined")},window.PDFObject={embed:function(t,e,n){return r(t,e,n)},pdfobjectversion:function(){return u}(),supportsPDFs:function(){return t}()}}(),function(){"use strict";window.docmana={},docmana.VERSION="0.1.0",docmana.lang="zh-CN",docmana.DEFAULTS={store:{url:null,requestData:{folder:null,subFolder:null}},commands:[["navigation",["back","forward"]],["new",["mkdir","upload"]],["open",["open","download"]],["clipboard",["cut","copy","paste"]],["organize",["duplicate","rename","rm"]],["layout",["layout"]],["view",["sort"]],["search",["search"]],["util",["full"]]],workzone:{layout:"list"},ui:["workzone","toolbar","navigation","statusbar","viewer","uploader"],kernel:["store","history","clipboard"]},docmana.commands={},docmana.ui={}}(),function(){"use strict";function i(t){this.initProps(t),this.listen(),this.init.apply(this,arguments)}"function"!=typeof Object.create&&(Object.create=function(){var t=function(){};return function(e){if(arguments.length>1)throw Error("Second argument not supported");if(e!==Object(e)&&null!==e)throw TypeError("Argument must be an object or null");if(null===e)return{};t.prototype=e;var n=new t;return t.prototype=null,n}}()),e.remove||(e.remove=function(t,e){for(var n=t.length-1;n>-1;n--){var i=t[n];e(i)&&t.splice(n,1)}}),e.orderBy||(e.orderBy=function(t,n,i){return e.each(n,function(n,a){t=e.sortBy(t,function(t){return t[n]}),"desc"===i[a]&&(t=t.reverse())}),t}),e.upperFirst||(e.upperFirst=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}),e.trim||(e.trim=String.prototype.trim||function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var a=function(t,n){var i,a=this;return i=t&&e.has(t,"constructor")?t.constructor:function(){return a.apply(this,arguments)},e.extend(i,a,n),i.prototype=e.create(a.prototype,t),i.prototype.constructor=i,i.__super__=a.prototype,i},o=e.extend({main:function(){return this.props.parent?this.props.parent.main:this.props.main},store:function(){return this.main().store},clipboard:function(){return this.main().clipboard},history:function(){return this.main().history},toolbar:function(){return this.main().ui.toolbar},statusbar:function(){return this.main().ui.statusbar},workzone:function(){return this.main().ui.workzone},initProps:function(t){this.props=e.extend({},e.result(this,"defaults"),t)},getState:function(){return{}},defaults:{},tpl:function(t){return docmana.template.get(t)},$element:function(){return this.$el},init:function(){},listen:function(){return this},render:function(){var t=this.tpl(e.result(this,"templateName"));t&&this.$el.html(t(this.getState())),this.trigger("rendered")}});i.prototype=e.extend({constructor:i},o,n.Events),i.extend=a,docmana.ComponentBase=i,docmana.CommandBase=i.extend({setState:function(t){t=t||this.$element(),t&&(this.canExec()?this.enable():this.disable())},enable:function(){this.$element().removeClass("disabled").removeAttr("disabled")},disable:function(){this.$element().addClass("disabled").attr("disabled","disabeld")},canExec:function(){if(this.enabledWhen){var t=this.workzone().select();if("selected"===this.enabledWhen&&t.length<=0)return!1;if("single"===this.enabledWhen&&1!==t.length)return!1;if("multiple"===this.enabledWhen&&t.length<1)return!1}return!0},exec:function(){},listenUI:function(){this.enabledWhen&&this.listenTo(this.workzone(),"selected refresh",function(){this.setState()})},shortcutExec:function(){this.canExec()&&this.exec()},render:function(){var e={name:this.name,icon:this.icon||"docmana-icon docmana-icon-"+this.name,shortcuts:null==this.shortcuts?"":"("+this.shortcuts+")"},n=this.tpl(this.templateName),i=n(e);return this.$el=t(i),this.trigger("rendered"),this.listenUI(),this.setState(),this.$el}}),docmana.ViewBase=n.View.extend(e.extend({initialize:function(t){this.initProps(t),this.listen(),this.props.autoAction&&(this.events||(this.events={}),e.extend(this.events,{"click [data-action]":"_actionHandler","click [data-command]":"_commandHandler"}),this.delegateEvents()),this.init.apply(this,arguments),this.props.autoRender&&this.render()},_commandHandler:function(e){var n=t(e.currentTarget),i=n.attr("data-command"),a=this.main().command(i);a&&a.canExec()&&a.exec(n.data())},_actionHandler:function(e,n){e.preventDefault(),n||(n=this);var i=t(e.currentTarget);if(!(i.closest("script").length>0)){var a="_"+i.data().action;a.indexOf("Handler")<0&&(a+="Handler"),n[a]&&n[a](e)}}},o)),docmana.CommandContainer=docmana.ViewBase.extend({_getCommandOptions:function(){var t=this.props.commands||[];return e.filter(this.main().props.commands,function(n){var i=n[0];return null!=e.find(t,function(t){var n=e.isString(t)?t:t.name;return n===i})})},_getCommandGroups:function(){var t=this,n={};return e.forEach(this._getCommandOptions(),function(i){var a=i[0],o=i[1];n[a]=e.compact(e.map(o,function(e){var n=t.main().command(e);return n}))}),n},_getCommandGroupDom:function(n,i){if(n.length>0){var a=t(this.tpl("toolbarBtnGroup")({name:i}));return e.forEach(n,function(t){a.append(t.render())}),a}return""},_getCommandAppendTo:function(t){var n=e.find(this.props.commands,function(e){return e.name===t});return null==n?this.$el:this.$(n.to)},_renderCommands:function(){var t=this._getCommandGroups(),n=this;e.forEach(t,function(t,e){n._getCommandAppendTo(e).append(n._getCommandGroupDom(t,e))})}})}(),function(){"use strict";docmana.utils={formatString:function(){for(var t=arguments[0],e=0;e<arguments.length-1;e++){var n=new RegExp("\\{"+e+"\\}","gm");t=t.replace(n,arguments[e+1])}return t},formatFileSize:function(t,e,n){null==n&&(n=!0),null==e&&(e=!1);var i=n?1e3:1024,a=n?["KB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1,s=1;if(e)t/=i,o=0,s=0,1>t&&t>0&&(t=1);else{if(Math.abs(t)<i)return t+" B";do t/=i,++o;while(Math.abs(t)>=i&&o<a.length-1)}return t.toFixed(s)+" "+a[o]},fileNameExtension:function(t){return"."+t.split(".").pop()},unixTimestamp:function(){return Math.round((new Date).getTime()/1e3)},selectSelectableElement:function(e,n){t(".ui-selected",e).not(n).removeClass("ui-selected ui-selectee").addClass("ui-unselecting"),t(n).addClass("ui-selecting ui-selectee");var i=e.data("ui-selectable");i._mouseStop(null)},setInputSelection:function(t,e,n){if(t.focus(),t.setSelectionRange)t.setSelectionRange(e,n);else if("undefined"!=typeof t.selectionStart)t.selectionStart=e,t.selectionEnd=n;else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveStart("character",e),i.moveEnd("character",n-e),i.select()}},setInputSelectionWithoutExtension:function(t){var e=t.val(),n=e.lastIndexOf(".");n=n>0?n:e.length,docmana.utils.setInputSelection(t[0],0,n)},inlineEdit:function(n,i,a,o){null==a&&(a=0),null==o&&(o=!1);var s,r=e.trim(n.text());s=0===a?t('<input name="temp" type="text" class="inline-edit" />').autosizeInput():t('<textarea name="temp" class="inline-edit" tabindex="2"></textarea>'),s.val(r).on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),t(this).blur())}),0===a?s.width(n.outerWidth()+30):s.height(n.outerHeight()),n.hide(),n.after(s),s.focus(),s.on("blur",function(){var e=t(this).val();(o||""!==e&&r!==e)&&(n.text(e),i(e)),t(this).remove(),n.show()}),docmana.utils.setInputSelectionWithoutExtension(s)},ieVersion:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return e>0||navigator.userAgent.match(/Trident.*rv\:11\./)?parseInt(t.substring(e+5,t.indexOf(".",e))):!1}}}(),window.docmana.templates=Object.create(null),window.docmana.templates["breadcrumb.html"]='<% _.forEach(data, function(item, i){ %>\n    <% if(i === data.length - 1){ %>\n    <li class="active">\n        <span>\n            <%- item.name %>\n        </span>\n    </li>\n    <% }else{ %>\n    <li>\n        <a href="#" data-hash="<%- item.hash %>">\n            <%- item.name %>\n        </a>\n    </li>\n    <% } %>\n<% }); %>',window.docmana.templates["fileInfo.html"]='<div class="docmana-file-info">\n    <div class="media center-block">\n        <div class="media-left file-type-large">\n            <span class="filetype <%- T.name2IconClass(data.name, data.mime) %>"></span>\n        </div>\n        <div class="media-body">\n            <h4 class="media-heading">\n                <%- data.name%>\n            </h4>\n            <p>\n            <p>\n                <%- L(\'fileType\') %>:\n                <%- L(\'kind\' + T.mime2Type(data.mime)) %>\n            </p>\n            <p>\n                <%- L(\'fileDateModified\') %>:\n                <%- T.formatDate(data.ts) %>\n            </p>\n            <p>\n                <%- L(\'fileSize\') %>:\n                <%- T.formatFileSize(data.size) %>\n            </p>\n            </p>\n        </div>\n    </div>\n</div>\n',window.docmana.templates["main.html"]='<div class="docmana-panel">\n    <div class="docmana-heading panel-heading">\n        <div class="docmana-toolbar btn-toolbar"></div>\n    </div>\n    <div class="docmana-body panel-body no-padding">\n        <div class="docmana-navigation clearfix"></div>\n        <div class="docmana-workzone"></div>\n    </div>\n    <div class="docmana-footer panel-footer">\n        <div class="docmana-statusbar clearfix"></div>\n    </div>\n</div>\n\n<div class="modal fade" id="modal-file" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-lg static" role="document">\n        <div class="modal-content docmana-viewer"></div>\n    </div>\n</div>\n<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog" role="document">\n        <div class="modal-content docmana-uploader"></div>\n    </div>\n</div>',window.docmana.templates["navigation.html"]='<div class="nav-group"></div>\n<div class="breadcrumb-group form-control input-sm">\n    <ul class="docmana-breadcrumb breadcrumb no-margin"></ul>\n</div>\n<div class="search-group btn-toolbar"></div>\n<div class="refresh-group"></div>\n\n',window.docmana.templates["statusbar.html"]='<div class="status-text pull-left btn-sm"></div>\n<div class="pull-right btn-toolbar">\n    <div class="uploader btn-group"></div>\n    <div class="layout btn-group"></div>\n</div>',window.docmana.templates["statusbarText.html"]='<span class="text-total">\n    <%- data.count %>\n    <%- L(\'statusbarItems\') %>\n</span>\n<span class="text-selected">\n    <% if(data.selectedCount > 0){ %>\n    <%- L(\'statusbarSelectedItem\', data.selectedCount) %>\n\n    <span class="size">\n        <%- data.selectedSize %>\n    </span>\n    <% } %>\n</span>',window.docmana.templates["toolbar.html"]='<div class="right pull-right btn-toolbar">\n    \n</div>',window.docmana.templates["toolbarBtn.html"]='<button type="button" class="btn btn-default <%- data.name %>"\n        data-command="<%- data.name %>"\n        title="<%- L(\'cmd\' + _.upperFirst(data.name)) %> <%- data.shortcuts %>">\n    <i class="<%- data.icon %>"></i>\n</button>\n',window.docmana.templates["toolbarBtnGroup.html"]='<div class="btn-group btn-group-sm docmana-group-<%- data.name %>" role="group"></div>',window.docmana.templates["toolbarBtnLayout.html"]='<div class="btn-group btn-group-sm" data-toggle="buttons">\n    <label class="btn btn-default" title="<%- L(\'layoutList\') %>">\n        <input type="radio" name="layout" autocomplete="off" data-layout="list">\n        <i class="docmana-icon docmana-icon-listview"></i>\n    </label>\n    <label class="btn btn-default" title="<%- L(\'layoutLargeIcons\') %>">\n        <input type="radio" name="layout" autocomplete="off" data-layout="icons">\n        <i class="docmana-icon docmana-icon-iconsview"></i>\n    </label>\n</div>\n',window.docmana.templates["toolbarBtnSort.html"]='<div class="btn-group btn-group-sm <%- data.name %>">\n    <button type="button" class="btn btn-default dropdown-toggle"\n            data-toggle="dropdown" aria-haspopup="true"\n            aria-expanded="false"\n             title="<%- L(\'cmdSort\') %>">\n        <i class="<%- data.icon %>"></i>\n        <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu">\n        <li>\n            <a href="#" data-command="sort" data-field="name">\n                <i class=""></i>\n                <%- L(\'sortByName\') %>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-command="sort" data-field="size">\n                <%- L(\'sortBySize\') %>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-command="sort" data-field="mime">\n                <%- L(\'sortByType\') %>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-command="sort" data-field="ts">\n                <%- L(\'sortByDate\') %>\n            </a>\n        </li>\n        <li role="separator" class="divider"></li>\n        <li>\n            <a href="#" data-command="sort" data-order="asc">\n                <%- L(\'sortAscending\') %>\n            </a>\n        </li>\n        <li>\n            <a href="#" data-command="sort" data-order="desc">\n                <%- L(\'sortDescending\') %>\n            </a>\n        </li>\n    </ul>\n</div>\n',window.docmana.templates["toolbarBtnUpload.html"]='<a class="btn btn-default <%- data.name %>" data-command="<%- data.name %>"\n    title="<%- L(\'cmd\' + _.upperFirst(data.name)) %>">\n    <i class="<%- data.icon %>"></i>\n    <form enctype="multipart/form-data" method="POST">\n        <input type="file" name="upload[]" multiple value="" />\n    </form>\n</a>',window.docmana.templates["toolbarSearch.html"]='<div class="form-inline">\n    <div class="form-group has-feedback">\n        <input type="text" class="form-control input-sm" \n               placeholder="<%- L(\'textSearch\') %>">\n        <span class="form-control-feedback" aria-hidden="true">\n            <i class="fa fa-search"></i>\n        </span>\n    </div>\n</div>',window.docmana.templates["uploader.html"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    <h4 class="modal-title"><%- L(\'textFileUpload\') %></h4>\n</div>\n<div class="modal-body no-padding">\n    <div class="files list-group"></div>\n</div>\n<div class="modal-footer clearfix">\n    <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">\n        <%- L(\'textClose\') %>\n    </button>\n</div>',window.docmana.templates["uploaderFiles.html"]='        <% for (var i=0, file; file= data.files[i]; i++) { %>\n<div class="file-upload file">\n    <span class="list-group-item holder">.</span>\n    <div class="progress">\n        <div class="progress-bar progress-bar-info" style="width: 0"></div>\n    </div>\n    <div class="info list-group-item clearfix">\n        <div class="table-row">\n            <div class="name table-column">\n                <%- file.name %>\n            </div>\n            <div class="size table-column">\n                Processing...\n            </div>\n            <!--<div class="folder pull-left">\n        我的文件\n    </div>-->\n            <div class="status table-column">\n                <!--<i class="fa fa-check-circle text-success"></i>-->\n                <span class="percent"></span>\n                <span class="error"></span>\n            </div>\n            <div class="operator table-column">\n                <% if (!i && !data.options.autoUpload) { %>\n                <button class="btn btn-primary btn-sm start" disabled>\n                    <i class="fa fa-upload"></i>\n                </button>\n                <% } %>\n                <% if (!i) { %>\n                <button class="btn btn-link btn-warning btn-xs cancel">\n                    <i class="fa fa-ban"></i>\n                </button>\n                <% } %>\n            </div>\n        </div>\n    </div>\n</div>\n        <% } %>\n',window.docmana.templates["uploaderTrigger.html"]='<div class="btn-uploader btn-group-sm" style="position:relative;"  title="<%- L(\'textFileUpload\') %>">\n    <button class="btn btn-default btn-sm">\n        <i class="fa fa-tasks"></i>\n    </button>\n    <span class="badge badge-notify"></span>\n</div>',window.docmana.templates["viewer.html"]='<div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n    </button>\n    <h4 class="modal-title">�ļ�</h4>\n</div>\n<div class="modal-body no-padding docmana-viewer-body">\n\n</div>\n<div class="modal-footer clearfix">\n    <button type="button" class="btn btn-default"\n            title="<%- L(\'cmdDownload\') %>"\n            data-action="download">\n        <i class="docmana-icon docmana-icon-download"></i>\n    </button>\n    <button type="button" class="btn btn-default"\n            title="<%- L(\'textPreviousItem\') %>"\n            data-action="previous">\n        <i class="docmana-icon docmana-icon-back"></i>\n    </button>\n    <button type="button"\n            class="btn btn-default"\n            data-action="next"\n            title="<%- L(\'textNextItem\') %>">\n        <i class="docmana-icon docmana-icon-forward"></i>\n    </button>\n</div>',window.docmana.templates["workzoneIconsView.html"]='<div class="icons-view docmana-workzone-view clearfix">\n</div>\n',window.docmana.templates["workzoneIconsViewItem.html"]='<div id="<%- data.hash %>"\n     title="<%= T.fileMetadata(data) %>"\n     class="drag-block file-list-item <%- T.mime2Class(data.mime) %>"\n     data-name="<%- data.name %>">\n    <div class="filetype <%- T.name2IconClass(data.name, data.mime)%> drag-block"></div>\n    <div class="filename drag-block" title="<%- data.name %>">\n        <%- data.name %>\n    </div>\n</div>\n',window.docmana.templates["workzoneListView.html"]='<div class="list-view">\n    <div class="datatable-header panel panel-default">\n        <table class="table table-bordered table-condensed no-margin">\n            <colgroup>\n                <col />\n                <col style="width:135px;" />\n                <col style="width:135px;" />\n                <col style="width:90px;" />\n            </colgroup>\n            <thead>\n                <tr>\n                    <th><%- L(\'fileName\') %></th>\n                    <th><%- L(\'fileDateModified\') %></th>\n                    <th><%- L(\'fileType\') %></th>\n                    <th><%- L(\'fileSize\') %></th>\n                </tr>\n            </thead>\n        </table>\n    </div>\n    <div class="datatable-content">\n        <table class="table table-condensed no-margin">\n            <colgroup>\n                <col />\n                <col style="width:135px;" />\n                <col style="width:135px;" />\n                <col style="width:90px;" />\n            </colgroup>\n            <tbody class="docmana-workzone-view"></tbody>\n        </table>\n    </div>\n</div>\n',
window.docmana.templates["workzoneListViewItem.html"]='<tr id="<%- data.hash %>"\n    class="file-list-item <%- T.mime2Class(data.mime) %>"\n    data-name="<%- data.name %>">\n    <td class="name">\n        <span title="<%= T.fileMetadata(data) %>">\n            <span class="filetype <%- T.name2IconClass(data.name, data.mime) %> drag-block"></span>\n            <span class="filename drag-block">\n                <%- data.name %>\n            </span>\n        </span>\n\n    </td>\n    <td class="metadata date text-muted">\n        <span class="drag-block">\n            <%- T.formatDate(data.ts) %>\n        </span>\n    </td>\n    <td class="metadata type text-muted">\n        <span class="drag-block">\n            <%- L(\'kind\' + T.mime2Type(data.mime)) %>\n        </span>\n    </td>\n    <td class="metadata size text-muted">\n        <span class="drag-block">\n            <%- data.mime === \'directory\' ? \'\' : T.formatFileSize(data.size, true) %>\n        </span>\n    </td>\n</tr>\n',function(){"use strict";function n(e){return this.each(function(){var n=t(this),i=n.data("docmana"),a=t.extend({el:this},docmana.DEFAULTS,n.data(),"object"==typeof e&&e);i||n.data("docmana",i=new docmana.App(a)),"string"==typeof e&&i[e]()})}docmana.App=docmana.ViewBase.extend({init:function(){this.ui={},this.commands={},this._initKernel(),this._initCommands()},templateName:"main",defaults:{autoRender:!0,className:"static",panelClassName:"panel no-margin panel-default",commandOptions:{}},listen:function(){this.listenTo(this,"rendered",function(){this.$el.attr("tabindex",1).addClass("docmana").addClass(this.props.className).find(".docmana-panel").addClass(this.props.panelClassName),this._initUI(),this.startup();var t=this;setTimeout(function(){t.relayout()},1)}),this.listenTo(this,"started",function(){this.listenTo(this.store,"syncFail",function(t){docmana.ui.notify.error(t)})})},$panel:function(){return this.$(".docmana-panel")},relayout:function(){var t=docmana.utils.ieVersion();t&&9>=t&&(this.$el.hasClass("static")||this.$el.hasClass("fixed"))&&(this.$(".docmana-body").css({top:this.$(".docmana-heading").outerHeight(),bottom:this.$(".docmana-footer").outerHeight()}),this.$(".docmana-workzone").css({top:this.$(".docmana-navigation").outerHeight()}),this.$(".docmana-navigation .breadcrumb-group").css({"margin-left":"5px",width:this.$(".docmana-navigation").width()-this.$(".docmana-navigation .nav-group").outerWidth()-this.$(".docmana-navigation .search-group").outerWidth()-10}))},_initKernel:function(){var t=this;e.forEach(this.props.kernel,function(n){t[n]=docmana[n](e.extend({main:t},t.props[n]))})},_initUI:function(){var t=this;e.forEach(this.props.ui,function(n){t.ui[n]=docmana.ui[n](e.extend({el:t.$(".docmana-"+n),main:t},t.props[n]))}),this.$el.on("focus",function(){})},_initCommands:function(){var t=this;e.forEach(e.flatten(this.props.commands,!0),function(n){e.isArray(n)&&e.forEach(n,function(n){var i=docmana.commands[n](e.extend({main:t},t.props.commandOptions[n]));t.commands[n]=i})})},command:function(t){return this.commands[t]},exec:function(){var t=e.toArray(arguments),n=t.shift(),i=this.command(n);i&&i.exec.apply(i,t)},focus:function(){this.$el.focus()},startup:function(){this.$el[0].outerWidth;this.trigger("started"),this.store.open(null,1)}}),t.fn.docmana=n,t.fn.docmana.Constructor=docmana}(),function(){"use strict";var t=docmana.ComponentBase.extend({init:function(t){this._data=[],this.isCut=0},listen:function(){},data:function(t,e){return null!=t&&(e||t.length>0)&&(this._data=t,this.trigger("change",this._data)),this._data},cut:function(t){this.isCut=1,this.data(t)},copy:function(t){this.isCut=0,this.data(t)},paste:function(){if(!this.isEmpty()){var t=this,e=this.getIds(),n=this.store().cwd().hash,i=this.getSrcDir();this.isCut?this.store().moveTo(n,e,i).done(function(){t.empty()}):this.store().copyTo(i,n,e)}},empty:function(){this.data([],!0)},getSrcDir:function(){return this._data[0].phash},getIds:function(){return e.map(this.data(),function(t){return t.hash})},isEmpty:function(){return 0===this.data().length}});docmana.clipboard=function(e){return new t(e)}}(),function(){"use strict";var t=docmana.ComponentBase.extend({init:function(t){this.position=null,this._data=[]},listen:function(){this.listenTo(this.main().store,"cwdChange",function(){var t=this.main().store.cwd(),n=e.findIndex(this._data,function(e){return e.hash===t.hash});0>n?(this.add(t),this.position=this._data.length-1):this.position=n,this.trigger("change",this._data)})},byId:function(t){return e.find(this._data,function(e){return e.hash===t})},getPath:function(){return this._data.slice(0,this.position+1)},add:function(t){this.position<this._data.length-1&&this._data.splice(this.position+1,this._data.length-1-this.position),this._data.push(t)},forward:function(){this.canForward()&&(this.position=this.position+1,this.triggerOpen())},getCurrHash:function(){var t=this._data[this.position];return null!=t?t.hash:t},back:function(){this.canBack()&&(this.position=this.position-1,this.triggerOpen())},triggerOpen:function(){this.main().store.open(this.getCurrHash())},canForward:function(){return this.position+1<this._data.length},canBack:function(){return this._data.length>=2&&0!==this.position},storeHistory:function(){},restoreHistory:function(){}});docmana.history=function(e){return new t(e)}}(),function(){"use strict";docmana.mimeTypes={unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/msword":"MsWord","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/x-xz":"XZ","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","text/x-markdown":"Markdown","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"}}(),function(){"use strict";docmana.resources={},docmana.resource=function(){var t=docmana.resources[docmana.lang],n=e.toArray(arguments),i=n.shift(),a=t[i];return null==a?i:(n.unshift(a),docmana.utils.formatString.apply(docmana.utils,n))}}(),function(){"use strict";var n=docmana.ComponentBase.extend({init:function(t){this._data=[],this._sortBy={field:"name",order:"asc"},this._cwd=null},data:function(t){return null!=t&&(this._data=t),this._data},cwdData:function(){var t=this.cwd().hash;return e.filter(this._data,function(e){return e.phash===t})},url:function(t){return this.props.url},cwd:function(){return this._cwd},byId:function(t){return e.find(this._data,function(e){return e.hash===t})},byName:function(t){return e.find(this._data,function(e){return e.name===t})},byIds:function(t){var n=this;return e.compact(e.map(t,function(t){return n.byId(t)}))},listen:function(){this.listenTo(this,"sync",function(t,n){t.added&&(this._data=this._data.concat(t.added)),t.removed&&e.remove(this._data,function(n){return e.findIndex(t.removed,function(t){return n.hash===t})>=0}),t.files&&(this._data=t.files),t.cwd&&(null!=this._cwd&&this._cwd.hash===t.cwd.hash||(this._cwd=t.cwd,this.trigger("cwdChange",this.cwd()))),this.cleanData(),this.sortBy(),this.update(n)})},cleanData:function(){e.remove(this._data,function(t){return t.isNew})},sortBy:function(t,n,i){if(null!=t&&(this._sortBy.field=t),null!=n&&(this._sortBy.order=n),null==i&&(i=!0),i){var a=e.groupBy(this._data,function(t){return"directory"===t.mime});a["true"]=this._baseSortBy(a["true"]),a["false"]=this._baseSortBy(a["false"]),this._data=a["true"].concat(a["false"])}else this._data=this._baseSortBy(this._data);return this.trigger("sort",this._sortBy),this},update:function(t){t||(t={}),this.trigger("update",this._data,t)},_baseSortBy:function(t){var n=this._sortBy.field,i=this._sortBy.order;return"name"===n&&(n=function(t){return t.name.toLowerCase()}),e.orderBy(t,[n],[i])},mkdir:function(t,e){return this.post({cmd:"mkdir",target:e,name:t})},rename:function(t,e){return this.post({cmd:"rename",name:t,target:e})},moveTo:function(t,e,n){return n||(n=this.cwd().hash),this.paste(n,t,e,1)},copyTo:function(t,e,n){return this.paste(t,e,n,0)},open:function(t,e){return this.fetch({cmd:"open",target:t,init:e})},search:function(t,e){return this.fetch({cmd:"search",target:t,q:e})},content:function(t){return this.getJSON({cmd:"get",target:t})},paste:function(t,e,n,i){return t===e?this.duplicate(n):this.post({cmd:"paste",cut:i,dst:e,src:t,targets:n})},duplicate:function(t){return this.post({cmd:"duplicate",targets:t})},upload:function(t){var e=this;return t.ajaxSubmit({url:this.url(),dataType:"json",data:this.uploadParams(),success:function(t){e.trigger("sync",t)}})},uploadParams:function(){return this._getRequestParams({cmd:"upload",target:this.cwd().hash})},rm:function(t){return this.post({cmd:"rm",targets:t})},_getRequestParams:function(e){return t.extend({},this.props.requestData,e)},request:function(e,n,i){var a=this,o=this._getRequestParams(n);return null==i&&(i=!0),t.ajax({url:this.url(),type:e,data:o,dataType:"json"}).fail(function(t,e,n,i){a.trigger("syncFail",e)}).done(function(t){i&&a.trigger("sync",t,o)}).always(function(t){})},getJSON:function(t){return this.request("get",t,!1)},fileUrl:function(e,n){null==n&&(n=0);var i=this._getRequestParams({cmd:"file",target:e,download:n});return this.url()+"?"+t.param(i)},fetch:function(t){return this.request("get",t)},get:function(t){return this.request("get",t)},post:function(t){return this.request("post",t)}});docmana.store=function(t){return new n(t)}}(),function(){"use strict";var t=e.extend({formatDate:function(t,e){var n=new Date(1e3*t);return e||(e="yyyy/mm/dd HH:MM"),n.format(e)},_mime2ClassDep:function(t){var e="ico-";return t=t.split("/"),e+t[0]+("image"!==t[0]&&t[1]?" "+e+t[1].replace(/(\.|\+)/g,"-"):"")},name2IconClass:function(t,e){if("directory"===e)return"icon-folder";var n=t.split("."),i="icon-";return i+n[n.length-1]},mime2Class:function(t){return"directory"===t?"type-directory":"type-file"},mime2Type:function(t){return docmana.mimeTypes[t]},fileMetadata:function(t){var e=docmana.resource,n=[];return n.push(t.name),n.push(e("fileType")+": "+e("kind"+this.mime2Type(t.mime))),"directory"!==t.mime&&n.push(e("fileSize")+": "+this.formatFileSize(t.size)),n.push(e("fileDateModified")+": "+this.formatDate(t.ts)),n.join(" &#13; ")}},docmana.utils);docmana.templateHelper=t,e.templateSettings.imports||(e.docmanaTemplateHelper=t,e.docmanaResource=docmana.resource),docmana.template={_cache:{}},docmana.template.load=function(t){var n=this;e.forEach(t,function(t,e){n._cache[e]=n.compile(t)})},docmana.template.get=function(t){return this._cache[t+".html"]},docmana.template.compile=function(t){return e.templateSettings.imports||(t=t.replace(/T\./g,"_.docmanaTemplateHelper.").replace(/L\(/g,"_.docmanaResource(")),e.template(t,{imports:{$:jQuery,T:docmana.templateHelper,L:docmana.resource},variable:"data"})},docmana.template.load(docmana.templates)}(),function(t){"use strict";function e(e,a){this.element=e,this.$element=t(e),this.settings=t.extend({},i,a),this._defaults=i,this._name=n,this.init()}var n="clearIt",i={clearClass:"clear_input",focusAfterClear:!0,linkText:"&times;",callback:null};t.extend(e.prototype,{init:function(){var t=this,e=this.$element,n=e.parent(),i=this.settings.clearClass+"_div";n.hasClass(i)||n.addClass(i).append('<a style="position: absolute; cursor: pointer;" class="'+this.settings.clearClass+'">'+this.settings.linkText+"</a>"),this.$btn().on("click",function(e){t.clear()}),e.on("keyup keydown change focus",function(){t.toggleBtn(),t.hasText()||t.callback()}),this.toggleBtn()},$btn:function(){return this.$element.parent().find("."+this.settings.clearClass)},toggleBtn:function(){var t=this.$btn(),e=this.hasText()?"show":"hide";t[e](),this.layout()},layout:function(){var t=this.$element.outerWidth(),e=this.$element.outerHeight(),n=this.$btn();n.css({top:e/2-n.height()/2,left:t-e/2-n.height()/2-10})},callback:function(){"function"==typeof this.settings.callback&&this.settings.callback()},clear:function(){this.$element.val("").change(),this.toggleBtn(),this.settings.focusAfterClear&&this.$element.focus(),this.callback()},hasText:function(){return this.$element.val().replace(/^\s+|\s+$/g,"").length>0}}),t.fn[n]=function(i){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new e(this,i))})}}(jQuery);var o;return function(e){var n=function(){function t(t){"undefined"==typeof t&&(t=30),this.space=t}return t}();e.AutosizeInputOptions=n;var a=function(){function e(n,i){var a=this;this._input=t(n),this._options=t.extend({},e.getDefaultOptions(),i),this._mirror=t('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),t.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(t,e){a._mirror[0].style[e]=a._input.css(e)}),t("body").append(this._mirror),this._input.on("keydown keyup input propertychange change",function(t){a.update()}),function(){a.update()}()}return e.prototype.getOptions=function(){return this._options},e.prototype.update=function(){var t=this._input.val()||"";if(t!==this._mirror.text()){this._mirror.text(t);var e=this._mirror.width()+this._options.space;this._input.width(e)}},e.getDefaultOptions=function(){return this._defaultOptions},e.getInstanceKey=function(){return"autosizeInputInstance"},e._defaultOptions=new n,e}();e.AutosizeInput=a,function(t){var n="autosize-input",a=["text","password","search","url","tel","email","number"];t.fn.autosizeInput=function(o){return this.each(function(){if("INPUT"==this.tagName&&t.inArray(this.type,a)>-1){var s=t(this);s.data(e.AutosizeInput.getInstanceKey())||(o==i&&(o=s.data(n)),s.data(e.AutosizeInput.getInstanceKey(),new e.AutosizeInput(this,o)))}})},t(function(){t("input[data-"+n+"]").autosizeInput()})}(jQuery)}(o||(o={})),function(){"use strict";var t=docmana.CommandBase.extend({init:function(t){this.name="back",this.templateName="toolbarBtn",this.shortcuts="Alt+Left"},listen:function(){this.listenTo(this.main().store,"update",function(){this.setState()})},canExec:function(){return this.main().history.canBack()},exec:function(){return this.main().history.back()}});docmana.commands.back=function(e){return new t(e)}}(),function(){"use strict";var t="copy",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="selected",this.shortcuts="Ctrl+C"},exec:function(){var t=this.store().byIds(this.workzone().getIds());this.main().clipboard.copy(t)}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="cut",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="selected",this.shortcuts="Ctrl+X"},exec:function(){var t=this.workzone();t.$(".file-list-item.cut").removeClass("cut"),t.select().addClass("cut");var e=this.store().byIds(t.getIds());this.main().clipboard.cut(e)}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var n="download",i=docmana.CommandBase.extend({init:function(t){this.name=n,this.templateName="toolbarBtn",this.enabledWhen="selectedFiles"},_filteredIds:function(){var t=this.workzone().getIds(),n=this,i=e.filter(t,function(t){return"directory"!==n.store().byId(t).mime});return i},canExec:function(){var t=this.workzone().getIds();if(0===t.length)return!1;var n=this;return e.every(t,function(t){return"directory"!==n.store().byId(t).mime})},exec:function(){var n=this._filteredIds(),i=this;e.forEach(n,function(e){var n=i.store().fileUrl(e,1);t.fileDownload(n)})}});docmana.commands[n]=function(t){return new i(t)}}(),function(){"use strict";var t="duplicate",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="selected"},exec:function(){var t=this.workzone().getIds();this.store().duplicate(t)}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t=docmana.CommandBase.extend({init:function(t){this.name="forward",this.templateName="toolbarBtn",this.shortcuts="Alt+Right"},listen:function(){this.listenTo(this.main().store,"update",function(){this.setState()})},canExec:function(){return this.main().history.canForward()},exec:function(){return this.main().history.forward()}});docmana.commands.forward=function(e){return new t(e)}}(),function(){"use strict";var e="full",n=docmana.CommandBase.extend({init:function(t){this.name=e,this.templateName="toolbarBtn",this.enabledWhen=null,this.viewLayout=this.props.viewLayout},defaults:{viewLayout:"normal"},listen:function(){this.listenTo(this,"rendered",function(){this._setDisplay()})},_getReverse:function(){var t=this.viewLayout;return"normal"===t?"fullscreen":"normal"},_setDisplay:function(){var t=this.viewLayout;this.$el.find(".docmana-icon").removeClass("docmana-icon-"+this._getReverse()).addClass("docmana-icon-"+t)},toggle:function(e){this.viewLayout=this._getReverse(),this._setDisplay(),"fullscreen"===this.viewLayout?(this.main().$el.addClass("fixed"),t("body").addClass("overflow-hidden")):(this.main().$el.removeClass("fixed"),t("body").removeClass("overflow-hidden"))},exec:function(t){this.toggle()}});docmana.commands[e]=function(t){return new n(t)}}(),function(){"use strict";var t="layout",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtnLayout",this.enabledWhen=null},exec:function(){var t=this.$element().find("input[type=radio]:checked").data("layout");this.workzone().changeLayout(t)},listenUI:function(){var t=this.workzone().layout;this.$element().find("[data-layout="+t+"]").closest(".btn").button("toggle");var e=this;this.$el.on("change",function(t){e.exec()})}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="mkdir",n=0,i=docmana.CommandBase.extend({init:function(n){this.name=t,this.templateName="toolbarBtn",this.shortcuts="Alt+N",this.exec=e.debounce(e.bind(this.exec,this),500)},_generateName:function(){var t=" "+docmana.resource("new folder");return 0===n?t:t+" "+n},_generateUsableName:function(){for(var t=null,e=!0;e;)t=this._generateName(),e=null!=this.store().byName(t),n++;return t},shortcutExec:function(){this.canExec()&&this._exec()},_exec:function(){var t=this,e=this.store().cwd();if(e){var n=e.hash,i=this._generateUsableName();t.store().mkdir(i,n).done(function(){t.workzone().select(t.workzone().$items().first()),t.main().exec("rename")})}},exec:function(){this._exec()}});docmana.commands[t]=function(t){return new i(t)}}(),function(){"use strict";var t="mkfile",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn"}});docmana.commands[t]=function(t){return new e(t)}}(),function(){var t="open",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="single",this.shortcuts="Return"},exec:function(t){if(null==t||null==t.mime){var e=this.workzone().select().attr("id");t=this.store().byId(e)}if(null!=t)if("directory"===t.mime)this.store().open(t.hash);else{var n=this.main().ui.viewer;n&&n.callout()}}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="paste",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.shortcuts="Ctrl+V"},exec:function(){this.clipboard().paste()},listenUI:function(){this.listenTo(this.main().clipboard,"change",function(){this.setState()})},canExec:function(){return!this.main().clipboard.isEmpty()}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="refresh",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.shortcuts="F5"},exec:function(){var t=this.store().cwd().hash;this.store().open(t,0)}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="rename",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="single",this.shortcuts="F2"},exec:function(){var t=this;this.workzone().editItemName(function(e){var n=t.workzone().getIds()[0];t.store().rename(e,n).done(function(){t.main().focus()})})}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="rm",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtn",this.enabledWhen="selected",this.shortcuts="Del"},exec:function(){var t=this.workzone().getIds();if(t.length>0){var e=this;docmana.ui.notify.confirm(function(){e.store().rm(t)})}}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var t="search",n=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarSearch"},exec:function(){var t=e.trim(this.$input().val());if(""!==t&&null!=t){var n=this.store().cwd().hash;this.store().search(n,t)}},$input:function(){return this.$element().find("input")},listen:function(){this.listenTo(this,"rendered",function(){var t=this;this.$el.on("keydown",function(e){13===e.which&&(e.preventDefault(),t.exec())}),this.$input().clearIt({callback:function(){var e=t.store().cwd().hash;t.store().open(e)}})})}});docmana.commands[t]=function(t){return new n(t)}}(),function(){"use strict";var t="sort",e=docmana.CommandBase.extend({init:function(e){this.name=t,this.templateName="toolbarBtnSort",this.enabledWhen=null},setState:function(){var t=this.$element(),e=this.store()._sortBy;t.find(".active").removeClass("active"),t.find("[data-field="+e.field+"]").addClass("active"),t.find("[data-order="+e.order+"]").addClass("active")},listenUI:function(){this.listenTo(this.store(),"sort",function(t){this.setState()})},exec:function(t){t||(t={}),this.store().sortBy(t.field,t.order),this.store().update()}});docmana.commands[t]=function(t){return new e(t)}}(),function(){"use strict";var e="upload",n=docmana.CommandBase.extend({init:function(t){this.name=e,this.templateName="toolbarBtnUpload"},listen:function(){this.listenTo(this.main(),"started",function(){var e=this;if(this.$el){var n=this.$el.find(":file"),i=this.main().ui.uploader;t.fn.fileupload&&i?i.build(n):n.on("change",function(){var n=t(this).val();""!==n&&null!=n&&e.store().upload(t(this).closest("form"))})}}),this.listenTo(this,"rendered",function(){})},enable:function(){docmana.CommandBase.prototype.enable.apply(this,arguments),this.$element().find(":file").removeAttr("disabled")},disable:function(){docmana.CommandBase.prototype.disable.apply(this,arguments),this.$element().find(":file").attr("disabled","disabled")}});docmana.commands[e]=function(t){return new n(t)}}(),function(){"use strict";var e=docmana.ViewBase.extend({listen:function(){this.listenTo(this.history(),"change",function(){this.render()})},events:{"click li > a":"_linkHandler"},$breadcrumb:function(){return this.$(".breadcrumb")},render:function(){var t=this.tpl("breadcrumbs"),e=this.history().getPath();this.$el.html(t(e)),this._interactive()},_interactive:function(){var e=this;this.$("li > a:not(.ui-droppable)").droppable({accept:".file-list-item",hoverClass:"drop-active",drop:function(n,i){var a=e.workzone().getIds(i.draggable),o=t(n.target).attr("data-hash");e.store().moveTo(o,a)}})},_linkHandler:function(e){e.preventDefault();var n=t(e.currentTarget).attr("data-hash");this.main().exec("open",this.history().byId(n))}});docmana.ui.breadcrumbs=function(t){return new e(t)}}(),function(){"use strict";var e=docmana.CommandContainer.extend({templateName:"navigation",breadcrumbTemplateName:"breadcrumb",defaults:{autoAction:!0,autoRender:!0,commands:[{name:"navigation",to:".nav-group"},{name:"search",to:".search-group"},{name:"refresh",to:".search-group"}]},listen:function(){this.listenTo(this.history(),"change",function(){this._renderBreadcrumb()}),this.listenTo(this,"rendered",function(){this._renderBreadcrumb(),this._renderCommands()})},events:{"click .docmana-breadcrumb li > a":"_linkHandler"},$breadcrumb:function(){return this.$(".docmana-breadcrumb")},_renderBreadcrumb:function(){var t=this.tpl(this.breadcrumbTemplateName),e=this.history().getPath();this.$breadcrumb().html(t(e)),this._initBreadcrumbInteractive()},_initBreadcrumbInteractive:function(){var e=this;this.$("li > a:not(.ui-droppable)").droppable({accept:".file-list-item",hoverClass:"drop-active",drop:function(n,i){var a=e.workzone().getIds(i.draggable),o=t(n.target).attr("data-hash");e.store().moveTo(o,a)}})},_linkHandler:function(e){e.preventDefault();var n=t(e.currentTarget).attr("data-hash");this.main().exec("open",this.history().byId(n))}});docmana.ui.navigation=function(t){return new e(t)}}(),function(){"use strict";var e={_core:t.noop,warn:t.noop,success:t.noop,error:t.noop,confirm:t.noop};docmana.ui.notify=e,window.console&&(null==window.noty?(e._core=function(t){console[t.type](t.text)},e.warn=function(t){console.warn(t)},e.success=function(t){console.log(t)},e.error=function(t){console.error(t)},e.confirm=function(t,e,n){n||(n=docmana.resource("textConfirmOperate"));var i=window.confirm(n);i?t():e()}):(e._core=function(e){noty(t.extend({type:"warning",dismissQueue:!0,force:!0,layout:"topCenter",theme:"relax",closeWith:["click"],maxVisible:1,animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:100},timeout:!1,killer:!0,modal:!1},e))},e.warn=function(t){e._core({text:t,type:"warning",timeout:4e3})},e.success=function(t){e._core({text:t,timeout:2e3,type:"success"})},e.error=function(t){e._core({text:t,type:"error",timeout:!1})},e.confirm=function(t,n,i){i||(i=docmana.resource("textConfirmOperate")),e._core({text:i,type:"confirm",modal:!0,buttons:[{addClass:"btn btn-primary btn-xs",text:docmana.resource("textOk"),onClick:function(e){e.close(),t()}},{addClass:"btn btn-danger btn-xs",text:docmana.resource("textCancel"),onClick:function(t){t.close(),n()}}]})}))}(),function(){"use strict";var t=docmana.CommandContainer.extend({templateName:"statusbar",defaults:{autoRender:!0,commands:[{name:"layout",to:".layout"}]},listen:function(){this.listenTo(this.store(),"update",function(){this.updateStatus()}),this.listenTo(this.workzone(),"selected",function(){this.updateStatus()}),this.listenTo(this,"rendered",function(){this._renderCommands()})},updateStatus:function(){this.$(".status-text").html(this.tpl("statusbarText")(this.getStatus()))},getStatus:function(){var t=this.store().cwdData(),n=this.workzone().getIds(),i=e.reduce(e.map(this.store().byIds(n),function(t){return"directory"===t.mime?NaN:t.size}),function(t,e){return t+e},0);return{count:t.length,selectedCount:n.length,selectedSize:isNaN(i)?"":docmana.templateHelper.formatFileSize(i)}}});docmana.ui.statusbar=function(e){return new t(e)}}(),function(){"use strict";var t=docmana.CommandContainer.extend({className:"docmana-toolbar",templateName:"toolbar",defaults:{autoRender:!0,autoAction:!0,commands:["new","open","clipboard","organize",{name:"view",to:".right"},{name:"util",to:".right"}]},listen:function(){this.listenTo(this,"rendered",function(){this._renderCommands()})}});docmana.ui.toolbar=function(e){return new t(e)}}(),function(){"use strict";var n=docmana.ViewBase.extend({templateName:"uploader",init:function(){var t=this;this.parentDialog().on("shown.bs.modal",function(){}).on("hidden.bs.modal",function(){t.main().$el.focus()})},defaults:{autoRender:!0},events:{"click .cancel":"_cancelHandler"},listen:function(){this.listenTo(this.main(),"started",function(){var e=this,n=this.statusbar(),i=t(this.tpl("uploaderTrigger")());n&&(i.on("click",function(){e.parentDialog().modal("show")}).appendTo(n.$(".uploader")),e.$trigger=i)}),this.listenTo(this,"rendered",function(){this.parentDialog().modal({show:!1})})},parentDialog:function(){return this.$element().closest(".modal")},inputInstance:function(t){return t=t||this.$input,t.data("blueimp-fileupload")||t.data("fileupload")},$body:function(){return this.$(".files")},updateBadge:function(){var t=this.count(),e=this.$trigger.find(".badge");e.text(t),0===t?e.hide():e.show()},count:function(){var t=this.$(".file").length;return t},updateDialogDisplay:function(){0===this.count()?this.parentDialog().modal("hide"):this.parentDialog().modal("show")},build:function(n){var i=this,a=this.tpl("uploaderFiles"),o=docmana.utils.formatFileSize;n.fileupload({
url:this.store().url(),formData:function(){return e.map(i.store().uploadParams(),function(t,e){return{name:e,value:t}})},dataType:"json",add:function(e,n){if(e.isDefaultPrevented())return!1;var s=t(this),r=i.inputInstance(s),c=r.options;n.context=t(a({files:n.files,options:c})).data("data",n).addClass("processing"),i.$body().append(n.context),i.updateBadge(),i.updateDialogDisplay(),n.process().always(function(){n.context.each(function(e){t(this).find(".size").text(o(n.files[e].size))}).removeClass("processing")}).done(function(){n.context.find(".start").prop("disabled",!1),r._trigger("added",e,n)!==!1&&(c.autoUpload||n.autoUpload)&&n.autoUpload!==!1&&n.submit()}).fail(function(){n.files.error&&n.context.each(function(e){var i=n.files[e].error;i&&t(this).find(".status").text(i)})})},progress:function(e,n){if(e.isDefaultPrevented())return!1;var i=Math.floor(n.loaded/n.total*100);n.context&&n.context.each(function(){t(this).find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%"),t(this).find(".status > .percent").text(i+"%")})},fail:function(e,n){if(e.isDefaultPrevented())return!1;var a=i.inputInstance(t(this));n.context&&n.context.each(function(i){if("abort"!==n.errorThrown){var o=n.files[i];o.error=o.error||n.errorThrown,t(this).find(".folder").text(o.error)}else t(this).remove(),a._trigger("failed",e,n),a._trigger("finished",e,n)}),i.updateBadge(),i.updateDialogDisplay()},done:function(t,e){e.context.remove(),i.updateBadge(),i.updateDialogDisplay(),i.store().trigger("sync",e.result)}}),this.$input=n},_cancelHandler:function(e){e.preventDefault();var n=t(e.currentTarget).closest(".file-upload,.file-download"),i=n.data("data")||{};i.context=i.context||n,i.abort?i.abort():(i.errorThrown="abort",this.trigger("fail",e,i))}});docmana.ui.uploader=function(t){return new n(t)}}(),function(){"use strict";var t=docmana.ViewBase.extend({templateName:"viewer",defaults:{autoAction:!0,autoRender:!0,fileType:[".txt",".csv",".pdf",".jpg",".gif",".png",".tiff",".ppt",".pptx",".doc",".docx",".xls",".xlsx"]},init:function(){var t=this;this.parentDialog().on("shown.bs.modal",function(){t.$body().css({top:t.$(".modal-header").outerHeight(),bottom:t.$(".modal-footer").outerHeight()}),t.viewCurrent()}).on("hidden.bs.modal",function(){t.$body().html(""),t.main().$el.focus()})},listen:function(){this.listenTo(this.workzone(),"selected",function(){this.$el.is(":visible")&&this.viewCurrent()}),this.listenTo(this,"rendered",function(){this.parentDialog().modal({show:!1})})},parentDialog:function(){return this.$element().closest(".modal")},callout:function(){this.parentDialog().modal("show")},$body:function(){return this.$el.find(".docmana-viewer-body")},viewCurrent:function(){var t=this,e=t.workzone().getIds();if(e.length>0){var n=e[0];t.$body().html("");var i=t.store().byId(n),a=docmana.utils.fileNameExtension(i.name);if(t.parentDialog().find(".modal-title").text(i.name),t.props.fileType.indexOf(a)>=0)t.store().content(n).done(function(e){if("path"===e.view){var n=t.store().fileUrl(e.content);".pdf"===a?PDFObject.embed(n,t.$body()):t.$body().html('<iframe src="'+n+'"></iframe>')}"content"===e.view&&t.$body().html(e.content)});else{var o=this.tpl("fileInfo");t.$body().html(o(i))}}},_previousHandler:function(t){this.workzone().selectTo("previous")},_nextHandler:function(t){this.workzone().selectTo("next")},_downloadHandler:function(t){this.main().exec("download")}});docmana.ui.viewer=function(e){return new t(e)}}(),function(){"use strict";var n=docmana.ViewBase.extend({init:function(){var t=this;this._buffer=[],this._selected=[],this._cwd=null,this._timer=[],this.layout=this.props.layout,this._moving=!1,this._renderListThrottle=e.throttle(e.bind(this._renderList,this),100),this._triggerSelectDebounce=e.debounce(e.bind(function(){this.trigger("selected",this.select())},this),200);var n=0,i=0;this.$el.on("mousedown",function(e){t._moving=!1,n=e.clientX,i=e.clientY}).on("mousemove",function(e){e.clientX===n&&e.clientY===i||(t._moving=!0)}),this._initHotKeys(),this._initSelectableInteractive(),this.render()},events:{scroll:"_scrollHandler","dblclick .file-list-item":"_itemDblClickHandler","mousedown .file-list-item .filename":"_editNameHandler",click:"_clickHandler"},defaults:{bottomThreshold:50,itemCountPerScreen:50},listen:function(){this.listenTo(this.store(),"update",function(t,e){e.cmd&&("rename"===e.cmd&&this._updateSelectedCache(e.target,e.name),"mkdir"===e.cmd),this.source(t)}),this.listenTo(this,"refresh",function(t){this._renderList(!1),this._restoreSelectUI()}),this.listenTo(this,"selected",function(n){this._selected=e.map(n,function(e){return{name:t(e).data("name"),id:t(e).attr("id")}})})},changeLayout:function(t){this.layout=t,this.render(),this.trigger("layout"),this.source(this.store()._data)},isListLayout:function(){return"list"===this.layout},source:function(t){this._buffer=this.store().cwdData(),this.store().cwd().hash!==this._cwd&&(this._cwd=this.store().cwd().hash,this._selected=[]),this.trigger("refresh",this._buffer)},getIds:function(e){null==e&&(e=this.select());var n=t.map(e,function(e){return t(e).attr("id")});return n},render:function(){var t=this.isListLayout()?this.tpl("workzoneListView"):this.tpl("workzoneIconsView");this.$el.html(t(this.props)),this.$view=this.$(".docmana-workzone-view"),this._buffer.length>0&&this.trigger("refresh")},select:function(t){return null!=t&&docmana.utils.selectSelectableElement(this.$el,t),this.$(".file-list-item.ui-selected")},_updateSelectedCache:function(t,n){var i=e.find(this._selected,function(e){return e.id===t});null!=i&&(i.name=n)},_restoreSelectUI:function(){var t=this,n=e.compact(e.map(this._selected,function(e){return t.$('[data-name="'+e.name+'"]')[0]}));t.select(n)},_renderItem:function(t){var e=this.isListLayout()?"workzoneListViewItem":"workzoneIconsViewItem";return this.tpl(e)(t)},_renderList:function(e){null==e&&(e=!0);var n=this,i=(this.$el,this.props.bottomThreshold,this.props.itemCountPerScreen),a=(this.$("[id]:last"),this._buffer.splice(0,i)),o=t.map(a,function(t){return n._renderItem(t)});this.$view[e?"append":"html"](o.join("")),this._setItemInteractive(),this.$el.selectable("refresh")},$items:function(){return this.$(".file-list-item")},_getShiftSelected:function(t){var e=this.$items(),n=e.filter(".ui-selected").first(),i=e.filter(".ui-selected").last(),a=e.index(t),o=e.index(n),s=e.index(i);return o=Math.min(a,o),s=Math.max(a,s),e.slice(o,s+1)},_isNormalMouseEvent:function(t){return!t.shiftKey&&!t.ctrlKey&&!t.metaKey},_initSelectableInteractive:function(){var e=this;this.$el.on("mousedown",".file-list-item",function(n){var i=t(n.currentTarget);if(e._isNormalMouseEvent(n))i.hasClass("ui-selected")||e.select(i);else{if(n.preventDefault(),n.ctrlKey){var a=e.select();t.merge(i,a)}n.shiftKey&&(i=e._getShiftSelected(i)),e.select(i)}}).on("click",".file-list-item",function(n){var i=t(n.currentTarget);e.select().length>1&&e._isNormalMouseEvent(n)&&e.select(i)}).selectable({delay:50,filter:".file-list-item",start:function(t,n){e._clearTimer(),e.$(".inline-edit").blur()},selected:function(t,n){e._triggerSelectDebounce()},unselected:function(t,n){e._triggerSelectDebounce()},stop:function(t,e){}})},_setItemInteractive:function(){var e=this;this.$(".drag-block:not(.ui-draggable)").draggable({appendTo:e.$el,delay:100,helper:function(){return'<div class="cwd-draggable-helper"><span class="badge count"></span></div>'},cursorAt:{top:20,left:20},start:function(n,i){e._clearTimer();var a=e.select();t.ui.ddmanager.current.element=a;var o=t(a.find(".filetype").splice(0,4)).clone();t.each(o,function(e,n){t(n).addClass("icon"+e)}),i.helper.append(o).find(".count").html(a.length)}}),this.$(".file-list-item.type-directory:not(.ui-droppable)").droppable({accept:".file-list-item",hoverClass:"drop-active",drop:function(n,i){var a=e.getIds(i.draggable),o=t(n.target).attr("id");e.store().moveTo(o,a)}})},_unselectAll:function(t){t.shiftKey||t.ctrlKey||t.metaKey||this.select([])},_selectAll:function(){this.select(this.$(".file-list-item"))},_clearTimer:function(){for(;this._timer.length>0;){var t=this._timer.shift();clearTimeout(t)}},_scrollHandler:function(){this._renderListThrottle()},_clickHandler:function(e){e.preventDefault(),t(e.target).is(":input")||(this.$(".inline-edit").blur(),this._$focusEl().focus()),this._moving||0!==t(e.target).closest(".file-list-item").length||this._unselectAll(e)},_isSingleSelected:function(t){return t.closest(".file-list-item").hasClass("ui-selected")&&1===this.select().length},_editNameHandler:function(n){if(2!==n.button){var i=t(n.currentTarget);if(this._isSingleSelected(i)){var a=e.delay(e.bind(function(t){this._isSingleSelected(t)&&this.main().exec("rename")},this),700,i);this._timer.push(a)}}},_isSelecting:function(){return t(".ui-selectable-helper").length>0},_isInput:function(t){return t.is("input, textarea, select, button")},_itemDblClickHandler:function(e){this._isInput(t(e.target))||(this._clearTimer(),this.main().exec("open"))},_getSingleSelect:function(){var t=this.select().last();return 0===t.length?this.$items().first():t},editItemName:function(t,e){var n=this.select();if(1===n.length){var i=n.find(".filename"),a=this.isListLayout()?0:1;docmana.utils.inlineEdit(i,function(e){t(e)},a,e)}},selectTo:function(e){var n=this.$items(),i=this.select().last();if(0===i.length&&(i=n.first()),0!==i.length){var a=i,o=n.index(i);"next"===e&&o+1<n.length&&(a=t(n[o+1])),"previous"===e&&o-1>=0&&(a=t(n[o-1])),this.select(a)}},_$focusEl:function(){return this.main().$el},_initHotKeys:function(){var t=this;this._$focusEl().bind("keydown.docmana","left",function(e){t.isListLayout()||t.selectTo("previous")}).bind("keydown.docmana","right",function(e){t.isListLayout()||t.selectTo("next")}).bind("keydown.docmana","up",function(e){t.isListLayout()&&t.selectTo("previous")}).bind("keydown.docmana","down",function(e){t.isListLayout()&&t.selectTo("next")}).bind("keydown.docmana","ctrl+a",function(e){e.preventDefault(),t._selectAll()});var n=this.main().commands;e.forEach(n,function(e){e.shortcuts&&t._$focusEl().bind("keydown.docmana",e.shortcuts,function(t){t.preventDefault(),e.shortcutExec()})})}});docmana.ui.workzone=function(t){return new n(t)}}(),function(){"use strict";docmana.resources.en={cmdBack:"Back",cmdForward:"Forward",cmdOpen:"Open",cmdUpload:"Upload",cmdDownload:"Download",cmdCut:"Cut",cmdCopy:"Copy",cmdPaste:"Paste",cmdSort:"Sort by",cmdMkdir:"New folder",cmdDuplicate:"Duplicate",cmdRename:"Rename",cmdRm:"Remove",sortByName:"Name",sortBySize:"Size",sortByType:"Type",sortByDate:"Date modified",sortAscending:"Ascending",sortDescending:"Descending",fileName:"Name",fileDateModified:"Date modified",fileType:"Type",fileSize:"Size",statusbarItems:"items",statusbarSelectedItem:"{0} item selected",layoutList:"List",layoutLargeIcons:"Large Icons",textSearch:"Search...",textPreviousItem:"previous item",textNextItem:"next item",textFileUpload:"File uploader",textClose:"Close",textOk:"Ok",textCancel:"Cancel",textConfirmOperate:"Are you sure you want to do this operation?",labelLanguage:"Language: ",labelTheme:"Theme: ",kindUnknown:"Unknown",kindFolder:"Folder",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindXZ:"XZ archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindMarkdown:"Markdown text",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}}(),function(){"use strict";docmana.resources["zh-CN"]={cmdBack:"后退",cmdForward:"前进",cmdOpen:"打开",cmdUpload:"上传",cmdDownload:"下载",cmdCut:"剪切",cmdCopy:"复制",cmdPaste:"粘贴",cmdSort:"排序方式",cmdMkdir:"新建文件夹",cmdDuplicate:"副本",cmdRename:"重命名",cmdRm:"移除",sortByName:"名称",sortBySize:"大小",sortByType:"类型",sortByDate:"修改日期",sortAscending:"升序",sortDescending:"降序",fileName:"名称",fileDateModified:"修改日期",fileType:"类型",fileSize:"大小",statusbarItems:"个项目",statusbarSelectedItem:"选中 {0} 个项目",layoutList:"列表布局",layoutLargeIcons:"图标布局",textSearch:"搜索...",textPreviousItem:"前一项",textNextItem:"后一项",textFileUpload:"文件上传器",textClose:"关闭",textOk:"确定",textCancel:"取消",textConfirmOperate:"确定做此操作？",labelLanguage:"语言：",labelTheme:"主题：",kindUnknown:"未知",kindFolder:"文件夹",kindAlias:"别名",kindAliasBroken:"错误的别名",kindApp:"程序",kindPostscript:"Postscript 文档",kindMsOffice:"Microsoft Office 文档",kindMsWord:"Microsoft Word 文档",kindMsExcel:"Microsoft Excel 文档",kindMsPP:"Microsoft Powerpoint 演示",kindOO:"Open Office 文档",kindAppFlash:"Flash 程序",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent 文件",kind7z:"7z 压缩包",kindTAR:"TAR 压缩包",kindGZIP:"GZIP 压缩包",kindBZIP:"BZIP 压缩包",kindXZ:"XZ 压缩包",kindZIP:"ZIP 压缩包",kindRAR:"RAR 压缩包",kindJAR:"Java JAR 文件",kindTTF:"True Type 字体",kindOTF:"Open Type 字体",kindRPM:"RPM 包",kindText:"文本文件",kindTextPlain:"纯文本",kindPHP:"PHP 源代码",kindCSS:"层叠样式表(CSS)",kindHTML:"HTML 文档",kindJS:"Javascript 源代码",kindRTF:"富文本格式(RTF)",kindC:"C 源代码",kindCHeader:"C 头文件",kindCPP:"C++ 源代码",kindCPPHeader:"C++ 头文件",kindShell:"Unix 外壳脚本",kindPython:"Python 源代码",kindJava:"Java 源代码",kindRuby:"Ruby 源代码",kindPerl:"Perl 源代码",kindSQL:"SQL 脚本",kindXML:"XML 文档",kindAWK:"AWK 源代码",kindCSV:"逗号分隔值文件(CSV)",kindDOCBOOK:"Docbook XML 文档",kindImage:"图片",kindBMP:"BMP 图片",kindJPEG:"JPEG 图片",kindGIF:"GIF 图片",kindPNG:"PNG 图片",kindTIFF:"TIFF 图片",kindTGA:"TGA 图片",kindPSD:"Adobe Photoshop 图片",kindXBITMAP:"X bitmap 图片",kindPXM:"Pixelmator 图片",kindAudio:"音频",kindAudioMPEG:"MPEG 音频",kindAudioMPEG4:"MPEG-4 音频",kindAudioMIDI:"MIDI 音频",kindAudioOGG:"Ogg Vorbis 音频",kindAudioWAV:"WAV 音频",AudioPlaylist:"MP3 播放列表",kindVideo:"视频",kindVideoDV:"DV 视频",kindVideoMPEG:"MPEG 视频",kindVideoMPEG4:"MPEG-4 视频",kindVideoAVI:"AVI 视频",kindVideoMOV:"Quick Time 视频",kindVideoWM:"Windows Media 视频",kindVideoFlash:"Flash 视频",kindVideoMKV:"Matroska 视频",kindVideoOGG:"Ogg 视频"}}(),window.docmana});
//# sourceMappingURL=docmana.min.js.map
